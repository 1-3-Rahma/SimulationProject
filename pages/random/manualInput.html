<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Random Number Input</title>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/mathematical.css">
    <link rel="stylesheet" href="../../css/manualInput.css">
</head>
<body>
    <div class="container">
        <button class="btn back-btn" onclick="window.location.href='../home.html'">← Back to Main Menu</button>
        
        <h1>Manual Random Number Input</h1>

        <div class="info-box">
            <strong>Instructions:</strong> Enter how many random numbers you want to input, then fill in each cell. Each number should be between 0 and 1. Press Enter to move to the next cell.
        </div>

        <div class="form-container">
            <h2>Enter Number of Random Numbers</h2>
            <div class="input-group count-input-group">
                <label>Number of Random Numbers: *</label>
                <input type="number" id="numberCount" placeholder="e.g., 10" value="" min="1" required>
                <small>Enter how many random numbers you want to input</small>
            </div>
            <button class="btn" onclick="createInputCells()">Create Input Cells</button>
        </div>

        <div id="inputCellsContainer" class="form-container hidden">
            <h2>Enter Random Numbers</h2>
            <div id="inputCells" class="input-cells-wrapper"></div>
            <button class="btn" onclick="processManualInput()">Process Numbers</button>
        </div>

        <div id="resultsSection" class="results-container hidden">
            <div class="calc-section">
                <h2>Processed Random Numbers</h2>
                <div id="randomNumbersDisplay" class="result-numbers"></div>
                <div class="button-group">
                    <button class="btn small" onclick="copyNumbers()">Copy Numbers</button>
                    <button class="btn start-btn" onclick="goToNextPage()">Next →</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let processedNumbers = [];
        let numberOfCells = 0;

        function createInputCells() {
            const countInput = document.getElementById('numberCount');
            const count = parseInt(countInput.value);

            if (isNaN(count) || count <= 0) {
                alert('Please enter a valid number greater than 0!');
                return;
            }

            if (count > 1000) {
                if (!confirm(`You are requesting ${count} input cells. This may be slow. Continue?`)) {
                    return;
                }
            }

            numberOfCells = count;
            const container = document.getElementById('inputCells');
            const cellsContainer = document.getElementById('inputCellsContainer');
            
            // Clear previous cells
            container.innerHTML = '';

            // Create input cells
            for (let i = 0; i < count; i++) {
                const cellWrapper = document.createElement('div');
                cellWrapper.className = 'input-cell-wrapper';
                
                const label = document.createElement('label');
                label.textContent = `${i + 1}.`;
                label.className = 'cell-label';
                
                const input = document.createElement('input');
                input.type = 'number';
                input.step = 'any';
                input.min = '0';
                input.max = '1';
                input.id = `randomInput_${i}`;
                input.className = 'random-number-cell';
                input.placeholder = '0.000000';
                
                // Add Enter key navigation
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const nextIndex = i + 1;
                        if (nextIndex < count) {
                            document.getElementById(`randomInput_${nextIndex}`).focus();
                        } else {
                            // If last cell, focus on Process button
                            document.querySelector('#inputCellsContainer .btn').focus();
                        }
                    }
                });

                cellWrapper.appendChild(label);
                cellWrapper.appendChild(input);
                container.appendChild(cellWrapper);
            }

            cellsContainer.classList.remove('hidden');
            
            // Focus on first input
            if (count > 0) {
                document.getElementById('randomInput_0').focus();
            }
        }

        function processManualInput() {
            const numbers = [];
            const invalidIndices = [];

            // Collect all numbers from input cells
            for (let i = 0; i < numberOfCells; i++) {
                const input = document.getElementById(`randomInput_${i}`);
                const value = input.value.trim();
                
                if (value === '') {
                    invalidIndices.push(i + 1);
                    continue;
                }

                const num = parseFloat(value);
                
                if (isNaN(num)) {
                    invalidIndices.push(i + 1);
                    input.style.borderColor = '#c62828';
                } else if (num < 0 || num > 1) {
                    invalidIndices.push(i + 1);
                    input.style.borderColor = '#c62828';
                } else {
                    numbers.push(num);
                    input.style.borderColor = '#ddd';
                }
            }

            if (numbers.length === 0) {
                alert('Please enter at least one valid random number (between 0 and 1)!');
                return;
            }

            if (invalidIndices.length > 0) {
                alert(`Warning: ${invalidIndices.length} cell(s) have invalid or empty values. Only valid numbers between 0 and 1 will be used.`);
            }

            processedNumbers = numbers;
            displayNumbers(processedNumbers);
        }

        function displayNumbers(numbers) {
            const displayDiv = document.getElementById('randomNumbersDisplay');
            const resultsSection = document.getElementById('resultsSection');
            
            let html = `<strong>Total: ${numbers.length} numbers</strong><br><br>`;
            html += numbers.map((num, index) => {
                return `${index + 1}. ${num.toFixed(6)}`;
            }).join('<br>');
            
            displayDiv.innerHTML = html;
            resultsSection.classList.remove('hidden');
        }

        function copyNumbers() {
            if (processedNumbers.length === 0) {
                alert('No numbers processed yet!');
                return;
            }
            
            const numbersStr = processedNumbers.map(n => n.toFixed(6)).join(', ');
            navigator.clipboard.writeText(numbersStr).then(() => {
                alert('Numbers copied to clipboard!');
            }).catch(() => {
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        function goToNextPage() {
            if (processedNumbers.length === 0) {
                alert('Please enter and process random numbers first!');
                return;
            }
            
            // Store processed numbers in sessionStorage for use in next page
            sessionStorage.setItem('randomNumbers', JSON.stringify(processedNumbers));
            sessionStorage.setItem('randomMethod', 'Manual');
            
            // Get simulation options from sessionStorage to determine destination
            const simulationOptionsStr = sessionStorage.getItem('simulationOptions');
            let destinationPage = '../multiple/multiLimitedCustomer.html'; // Default
            
            if (simulationOptionsStr) {
                try {
                    const simulationOptions = JSON.parse(simulationOptionsStr);
                    
                    // Determine destination based on selections
                    if (simulationOptions.mainType === 'multiple') {
                        if (simulationOptions.subOption === 'multi-customers') {
                            destinationPage = '../multiple/multiLimitedCustomer.html';
                        } else if (simulationOptions.subOption === 'multi-service') {
                            if (simulationOptions.multiServiceType === 'arrival') {
                                destinationPage = '../multiple/multiLimitedServiceArrival.html';
                            } else if (simulationOptions.multiServiceType === 'end') {
                                destinationPage = '../multiple/multiLimitedServiceEnd.html';
                            }
                        }
                    }
                } catch (e) {
                    console.error('Error parsing simulation options:', e);
                }
            }
            
            // Navigate to appropriate simulation page
            window.location.href = destinationPage;
        }
    </script>
</body>
</html>

